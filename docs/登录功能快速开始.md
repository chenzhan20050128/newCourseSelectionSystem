# 登录功能快速开始指南

## 快速启动步骤

### 1. 初始化数据库

首先确保你的MySQL数据库已经运行，然后执行以下操作：

```bash
# 连接到MySQL
mysql -u root -p

# 创建数据库（如果还未创建）
CREATE DATABASE IF NOT EXISTS ncss CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE ncss;

# 执行建表脚本
source backend/src/main/resources/sql/createTable.sql;

# 执行数据初始化脚本
source backend/src/main/resources/sql/insertTable.sql;

# 执行用户初始化脚本
source backend/src/main/resources/sql/initUsers.sql;
```

或者直接在MySQL客户端中复制粘贴执行这些SQL文件的内容。

### 2. 配置数据库连接

检查 `backend/src/main/resources/application.properties` 确保数据库配置正确：

```properties
spring.datasource.url=jdbc:mysql://localhost:3306/ncss?useSSL=false&serverTimezone=Asia/Shanghai&characterEncoding=utf8
spring.datasource.username=root
spring.datasource.password=你的密码
```

### 3. 启动后端服务

```bash
cd backend
mvn clean install
mvn spring-boot:run
```

后端服务将在 http://localhost:8080 启动。

### 4. 启动前端服务

```bash
cd frontend
npm install
npm run dev
```

前端服务将在 http://localhost:5173 启动。

### 5. 测试登录功能

#### 方式1：使用前端页面

1. 在浏览器访问: http://localhost:5173
2. 如果需要单独访问登录页面，可以在路由中配置 `/login` 路径
3. 使用测试账号登录：
   - 学生账号：用户名 `1001` 或 `张三`，密码 `123456`
   - 教师账号：用户名 `2001` 或 `王教授`，密码 `123456`

#### 方式2：使用API测试工具（如Postman）

**登录请求**:
```
POST http://localhost:8080/api/auth/login
Content-Type: application/json

{
  "username": "1001",
  "password": "123456",
  "userType": "student"
}
```

**预期响应**:
```json
{
  "success": true,
  "message": "登录成功",
  "user": {
    "userId": 1,
    "username": "张三",
    "userType": "student",
    "college": "计算机学院",
    "phone": "13800138001"
  },
  "token": "生成的token字符串"
}
```

## 测试账号列表

### 学生账号
| 用户名(学号) | 姓名 | 密码 | 学院 |
|-------------|------|------|------|
| 1001 | 张三 | 123456 | 计算机学院 |
| 1002 | 李四 | 123456 | 软件学院 |
| 1003 | 王五 | 123456 | 信息学院 |

### 教师账号
| 用户名(工号) | 姓名 | 密码 | 学院 |
|-------------|------|------|------|
| 2001 | 王教授 | 123456 | 计算机学院 |
| 2002 | 刘老师 | 123456 | 软件学院 |
| 2003 | 陈老师 | 信息学院 | 123456 |

**注意**: 用户名可以使用ID（如 "1"）或者姓名（如 "张三"）。

## 常见问题

### Q1: 登录失败，提示"用户不存在"
**解决方案**: 
- 检查是否执行了 `initUsers.sql` 脚本
- 确认数据库中 students 和 instructors 表有数据

### Q2: 登录失败，提示"密码错误"
**解决方案**:
- 确保使用的密码是 `123456`
- 检查数据库中密码字段是否为 MD5 加密值：`e10adc3949ba59abbe56e057f20f883e`

### Q3: 前端无法连接到后端
**解决方案**:
- 确认后端服务已启动（http://localhost:8080）
- 检查 CORS 配置是否正确
- 检查防火墙设置

### Q4: 如何添加新用户？
**方式1 - 直接插入数据库**:
```sql
-- 添加学生（密码：123456，MD5加密）
INSERT INTO students (student_name, birth_date, college, phone, password) 
VALUES ('新学生', '2003-01-01', '计算机学院', '13900000000', 'e10adc3949ba59abbe56e057f20f883e');

-- 添加教师（密码：123456，MD5加密）
INSERT INTO instructors (instructor_name, college, password) 
VALUES ('新教师', '计算机学院', 'e10adc3949ba59abbe56e057f20f883e');
```

**方式2 - 使用工具类生成密码**:
```bash
cd backend
mvn compile
mvn exec:java -Dexec.mainClass="org.example.newcourseselectionsystem.util.PasswordUtil"
```

## API接口说明

### 登录接口
- **URL**: `/api/auth/login`
- **方法**: POST
- **请求体**:
  ```json
  {
    "username": "用户名或ID",
    "password": "密码",
    "userType": "student 或 instructor"
  }
  ```
- **响应**: LoginResponse 对象

### 登出接口
- **URL**: `/api/auth/logout`
- **方法**: POST
- **响应**: "登出成功"

## 下一步

登录功能已实现，你可以：

1. **集成到现有页面**: 将 Login.vue 组件集成到你的路由系统中
2. **添加权限控制**: 基于登录状态限制页面访问
3. **实现持久化登录**: 使用 localStorage 或 sessionStorage 保存登录状态
4. **添加导航守卫**: 在 Vue Router 中添加路由守卫检查登录状态
5. **升级安全性**: 考虑使用 BCrypt 替代 MD5，实现 JWT Token

## 集成示例

### 在 App.vue 或路由配置中使用：

```vue
<template>
  <div id="app">
    <router-view v-if="isLoggedIn" />
    <Login v-else @login-success="handleLoginSuccess" />
  </div>
</template>

<script>
import Login from './components/Login.vue';

export default {
  components: { Login },
  data() {
    return {
      isLoggedIn: false
    };
  },
  mounted() {
    // 检查是否已登录
    const user = localStorage.getItem('user');
    this.isLoggedIn = !!user;
  },
  methods: {
    handleLoginSuccess(user) {
      this.isLoggedIn = true;
    }
  }
};
</script>
```

需要帮助或有任何问题，请查看 `登录功能文档.md` 获取详细信息。
