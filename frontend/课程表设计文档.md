# 课程表功能详细设计文档

## 1. 功能概述

将"我的课程"页面改造为课程表格式，以周一到周日为列，第1-12节为行，展示学生的所有已选课程。支持时间冲突检测和均分单元格显示，每个课程可点击查看详细信息。

## 2. 整体布局设计

### 2.1 页面结构
- **顶部区域**：标题栏和刷新按钮
- **统计信息栏**：显示选课总数和总学分
- **课程表主体**：网格布局的课程表
- **课程详情对话框**：点击课程时弹出

### 2.2 课程表网格布局
- **行**：第1节到第12节，每行显示节次编号和时间范围
- **列**：周一、周二、周三、周四、周五、周六、周日，共7列
- **单元格**：每个单元格代表一个时间段（某天某节）
- **课程块**：跨多个单元格显示，包含课程名称和教室信息

### 2.3 节次时间映射
- 第1节：08:00-08:50
- 第2节：09:00-09:50
- 第3节：10:10-11:00
- 第4节：11:10-12:00
- 第5节：14:00-14:50
- 第6节：15:00-15:50
- 第7节：16:10-17:00
- 第8节：17:10-18:00
- 第9节：18:30-19:20
- 第10节：19:30-20:20
- 第11节：20:30-21:20
- 第12节：21:30-22:20

## 3. 数据结构设计

### 3.1 课程数据模型
每个课程包含：
- 课程基本信息（ID、名称、学分、学院、校区、教室、教师ID、周次范围等）
- 节次数组（sessions），每个节次包含：
  - weekday：周几（周一-周日）
  - startPeriod：开始节次（1-12）
  - endPeriod：结束节次（1-12）

### 3.2 课程表单元格数据模型
每个单元格需要存储：
- 位置信息：weekday（列）、period（行）
- 课程块数组：在该单元格显示的课程块列表
- 每个课程块包含：
  - 课程对象引用
  - 该课程块占据的单元格范围（startPeriod, endPeriod）
  - 在冲突中的位置索引（用于计算均分比例）
  - 颜色标识

### 3.3 冲突检测数据结构
- 冲突组：同一时间段（相同weekday和period范围）的多个课程
- 冲突组信息：
  - weekday：周几
  - period范围：startPeriod到endPeriod
  - 冲突课程列表：按某种规则排序
  - 冲突数量：决定均分比例

## 4. 核心算法设计

### 4.1 时间冲突检测算法

**目标**：找出所有在时间上重叠的课程组合

**步骤**：
1. 遍历所有课程的每个session
2. 对于每个session，生成其占用的所有period集合（从startPeriod到endPeriod）
3. 对于同一weekday，检查不同课程的period集合是否有交集
4. 如果有交集，则这些课程在该时间段存在冲突
5. 将冲突的课程分组，每组包含：
   - weekday
   - 冲突的period范围（交集部分）
   - 冲突的课程列表

**示例**：
- 大学语文：周一 5-7节
- 高等数学：周一 5-6节
- 检测结果：周一5-6节存在冲突（两门课），周一7节只有大学语文（无冲突）

### 4.2 单元格布局计算算法

**目标**：为每个课程块计算其在课程表中的显示位置和尺寸

**步骤**：
1. 初始化课程表网格：12行（节次）× 7列（周几）
2. 对于每个课程的每个session：
   - 确定其占用的列（weekday对应的列索引）
   - 确定其占用的行范围（startPeriod到endPeriod）
   - 检查该时间段是否有冲突
3. 如果有冲突：
   - 计算冲突组中该课程的索引位置
   - 计算均分后的宽度（100% / 冲突数量）
   - 计算水平偏移（索引 × 宽度）
   - 设置课程块的CSS样式：width、left或使用flex布局
4. 如果没有冲突：
   - 课程块占据整个单元格宽度（100%）

**均分策略**：
- 2个冲突：各占50%，左半部分和右半部分
- 3个冲突：各占33.33%，左、中、右三部分
- N个冲突：各占100%/N，均匀分布

### 4.3 跨节次课程块处理

**问题**：一个课程可能跨多个节次（如第5-7节）

**解决方案**：
1. 将跨节次的课程块拆分为多个单元格块
2. 每个单元格块独立计算冲突和布局
3. 使用CSS的rowspan或grid-row-span来合并行
4. 或者使用绝对定位，让课程块跨越多个单元格

**推荐方案**：使用CSS Grid布局
- 设置grid-template-rows为12行
- 设置grid-template-columns为7列
- 课程块使用grid-row和grid-column来定位
- 冲突时，在同一grid-cell内使用flex布局均分

## 5. 颜色分配策略

### 5.1 颜色池设计
预定义一组颜色，确保视觉区分度：
- 浅粉色：#FFE5E5
- 浅绿色：#E5F5E5
- 浅蓝色：#E5F0FF
- 浅黄色：#FFF9E5
- 浅紫色：#F0E5FF
- 浅橙色：#FFE8D5
- 浅青色：#E5F5F5
- 浅灰色：#F5F5F5

### 5.2 颜色分配规则
1. 为每个课程分配一个主颜色（基于课程ID的哈希值或顺序）
2. 同一课程的所有session使用相同颜色
3. 确保相邻课程颜色对比度足够
4. 如果颜色池用完，循环使用

### 5.3 颜色应用
- 课程块背景色：使用分配的颜色
- 课程块边框：使用同色系的深色（增加20%深度）
- 文字颜色：根据背景色亮度自动选择黑色或白色

## 6. 交互设计

### 6.1 课程块交互
- **悬停效果**：鼠标悬停时，课程块稍微放大或加深边框
- **点击事件**：点击课程块，弹出课程详情对话框
- **视觉反馈**：点击时有轻微的按下动画效果

### 6.2 课程详情对话框设计

**对话框内容**：
- 课程名称（大标题）
- 课程ID
- 学分
- 学院
- 校区
- 教室
- 教师ID
- 周次范围（第X周-第Y周）
- 课程描述（如果有）
- 选课容量（已选/总容量）
- 所有节次信息列表
- 退课按钮

**对话框样式**：
- 居中显示
- 半透明背景遮罩
- 圆角卡片样式
- 关闭按钮（右上角X或点击遮罩关闭）
- 响应式设计，适配不同屏幕尺寸

### 6.3 对话框交互
- 打开：点击课程块时，显示对话框并加载课程详细信息
- 关闭：点击关闭按钮、点击遮罩、按ESC键
- 退课：在对话框中点击退课按钮，确认后执行退课，成功后关闭对话框并刷新课程表

## 7. 样式设计

### 7.1 课程表网格样式
- 使用CSS Grid布局
- 固定表头（周几和节次）
- 单元格边框：1px实线，浅灰色
- 单元格最小高度：60px（可根据内容调整）
- 单元格内边距：4px

### 7.2 课程块样式
- 圆角：4px
- 内边距：8px
- 字体大小：12-14px
- 文字溢出处理：超出部分显示省略号
- 阴影：轻微阴影增加层次感
- 过渡动画：0.2s ease

### 7.3 冲突课程块样式
- 在同一单元格内使用flex布局
- 每个冲突课程块占据计算出的宽度
- 相邻块之间有1px分隔线
- 保持相同的垂直对齐

### 7.4 响应式设计
- 桌面端：完整显示7列
- 平板端：可以横向滚动
- 移动端：考虑只显示部分列，或使用横向滚动

## 8. 性能优化考虑

### 8.1 渲染优化
- 使用Vue的虚拟滚动（如果课程表很大）
- 只渲染可见区域的课程块
- 使用CSS transform代替left/top定位（GPU加速）

### 8.2 计算优化
- 冲突检测算法时间复杂度：O(n²)，n为课程session总数
- 缓存冲突检测结果，只在课程数据变化时重新计算
- 使用Map数据结构快速查找冲突

### 8.3 内存优化
- 避免重复创建课程块对象
- 使用计算属性缓存布局计算结果

## 9. 边界情况处理

### 9.1 无课程情况
- 显示提示信息："您还没有选课"
- 课程表显示空网格

### 9.2 单个课程跨多天多节
- 正常处理，每个session独立计算布局

### 9.3 多个课程在同一时间段（3个以上）
- 均分算法自动处理，最多支持显示课程名称的前几个字
- 如果空间不足，考虑使用tooltip显示完整信息

### 9.4 课程节次超出1-12范围
- 数据验证，如果超出范围，不显示或显示错误提示

### 9.5 课程名称过长
- 文字溢出处理：显示省略号
- 悬停时显示完整名称（tooltip）

## 10. 实现步骤

### 阶段1：基础布局
1. 创建课程表网格结构（12行×7列）
2. 实现表头（周几和节次）
3. 实现基础样式

### 阶段2：课程块渲染
1. 遍历课程数据，生成课程块
2. 实现跨节次课程块的定位
3. 应用颜色分配

### 阶段3：冲突检测
1. 实现冲突检测算法
2. 识别所有冲突组

### 阶段4：均分布局
1. 实现均分算法
2. 在同一单元格内均分显示冲突课程
3. 处理各种冲突数量（2个、3个、N个）

### 阶段5：交互功能
1. 实现课程块点击事件
2. 创建课程详情对话框组件
3. 实现对话框的打开、关闭、退课功能

### 阶段6：优化和测试
1. 性能优化
2. 样式细节调整
3. 边界情况测试
4. 响应式适配

## 11. 技术选型

- **布局方案**：CSS Grid + Flexbox
- **状态管理**：Vue 3 Composition API
- **样式方案**：Scoped CSS + CSS变量
- **动画**：CSS Transition + Transform

## 12. 注意事项

1. 确保课程表在不同浏览器中显示一致
2. 考虑打印样式（如果需要）
3. 确保颜色对比度符合无障碍访问标准
4. 处理数据加载状态和错误状态
5. 考虑国际化（如果需要支持多语言）

